:root {
    --board-color: #dcb35c;
    --line-color: #000;
    --stone-size: 36px;
    --grid-size: 40px;
    --bg-color: #1a1c20;
}

body {
    font-family: 'Microsoft JhengHei', sans-serif;
    background-color: var(--bg-color);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    margin: 0;
}

h1 { margin-top: 10px; color: #f0a500; margin-bottom: 10px; }

/* 狀態列 */
.status-bar {
    background: #2c3e50;
    padding: 8px 20px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    width: 340px;
    border: 1px solid #444;
    font-size: 0.95em;
}

.turn-indicator, .capture-info {
    display: flex;
    align-items: center;
    gap: 8px;
}

.dot {
    width: 14px; height: 14px;
    border-radius: 50%;
    display: inline-block;
}
.dot.black { background: black; border: 1px solid #666; }
.dot.white { background: white; }

/* 棋盤 */
#game-board {
    position: relative;
    width: 380px; height: 380px;
    background-color: var(--board-color);
    border-radius: 4px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    margin-bottom: 20px;
    cursor: pointer;
    /* 修正：移除這裡的 linear-gradient，因為 JS 已經繪製了格線，避免重影 */
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

/* 格線層 */
.grid-layer {
    position: absolute;
    top: 20px; left: 20px;
    width: 320px; height: 320px;
    pointer-events: none;
}
.line-horz, .line-vert { position: absolute; background-color: var(--line-color); }
.line-horz { width: 100%; height: 1px; left: 0; }
.line-vert { height: 100%; width: 1px; top: 0; }

.star-point {
    position: absolute; width: 8px; height: 8px;
    background: #000; border-radius: 50%;
    transform: translate(-50%, -50%);
}

/* --- 棋子與動畫核心樣式 --- */
.stone {
    position: absolute;
    width: var(--stone-size); height: var(--stone-size);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 2px 2px 4px rgba(0,0,0,0.4);
    
    /* 層級管理：棋子在最底層，特效在上面 */
    z-index: 10; 
    
    /* 動畫過渡：包含 opacity, transform, box-shadow */
    transition: all 0.2s ease-out; 
}

.stone.black { background: radial-gradient(circle at 30% 30%, #555, #000); }
.stone.white { background: radial-gradient(circle at 30% 30%, #fff, #ddd); }

/* 1. 提子動畫：被吃掉的子縮小淡出 */
.stone.captured-anim {
    transform: translate(-50%, -50%) scale(0.1);
    opacity: 0;
    pointer-events: none;
}

/* 2. 棋串高亮 (Group Highlight)：層級 11 */
.stone.group-highlight {
    box-shadow: 0 0 10px 4px rgba(255, 255, 0, 0.8); /* 黃色光暈 */
    z-index: 11;
}

/* 3. 叫吃警告 (Atari)：層級 12 */
.stone.atari::before {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 8px; height: 8px;
    background-color: #e74c3c;
    border-radius: 50%;
    box-shadow: 0 0 4px #e74c3c;
    z-index: 12;
    animation: pulse 1s infinite;
    pointer-events: none;
}

/* 4. 最後一手標記 (Last Move)：層級 13 (最上層) */
.stone.last-move::after {
    content: ''; 
    position: absolute;
    top: 50%; left: 50%; 
    transform: translate(-50%, -50%);
    width: 10px; height: 10px;
    border: 2px solid red; 
    border-radius: 50%;
    z-index: 13;
}

/* 死子標記 (終局顯示) */
.stone.dead {
    opacity: 0.3;
}
.stone.dead::after {
    content: '✕';
    color: #c0392b; /*稍微深一點的紅，比較有質感*/
    font-weight: bold;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    border: none;
    z-index: 14;
}

/* --- 動畫定義 --- */
@keyframes pulse {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.6; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* --- 控制項與 Modal --- */
.controls-row {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}
button {
    padding: 10px 15px;
    border: none;
    border-radius: 20px;
    font-size: 15px;
    cursor: pointer;
    font-weight: bold;
    transition: 0.2s;
    min-width: 80px;
    font-family: inherit; /* 確保字體一致 */
}
button:active { transform: scale(0.95); }
button:disabled { background: #555; color: #888; cursor: not-allowed; }

.btn-primary { background: #3498db; color: white; }
.btn-secondary { background: #95a5a6; color: white; }
.btn-warning { background: #f39c12; color: white; }
.btn-info { background: #34495e; color: white; border: 1px solid #555; }
.btn-pass { background: #e74c3c; color: white; width: 100%; border-radius: 8px; }
.btn-confirm { background: #2ecc71; color: white; }

/* Modal 結果視窗 */
#result-modal {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center; align-items: center;
    z-index: 100;
    backdrop-filter: blur(2px);
}
.modal-content {
    background: #2c3e50;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid #f0a500;
    width: 300px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}
.score-box {
    background: #222;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    text-align: left;
}
.score-row { font-size: 1.1em; margin: 5px 0; display: flex; justify-content: space-between; }
.winner-text { 
    font-size: 1.4em; font-weight: bold; color: #f0a500; 
    margin-top: 15px; min-height: 1.5em; 
}
.modal-buttons {
    display: flex; gap: 10px; justify-content: center; margin-top: 20px;
}

/* Spinner (AI計算轉圈) */
.spinner {
    margin: 20px auto;
    width: 40px; height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}